
image:
  registry: {{ .registry | default "federatedai" }}
  isThridParty: {{ empty .registry | ternary  "false" "true" }}
  tag: 1.5.0-release
  pullPolicy: {{ .pullPolicy | default "IfNotPresent" }}

partyId: {{ .partyId }}
partyName: {{ .name }}

host:
  fateboard: {{ .partyId }}.fateboard.kubefate.net
  client: {{ .partyId }}.notebook.kubefate.net

istio:
  enabled: {{ with .istio }}{{ .enabled | default false }}{{ end }}

exchange:
{{- with .rollsite }}
{{- with .exchange }}
  partyIp: {{ .ip }}
  partyPort: {{ .port }}
{{- end }}
{{- end }}

partyList:
{{- with .rollsite }}
{{- range .partyList }}
  - partyId: {{ .partyId }}
    partyIp: {{ .partyIp }}
    partyPort: {{ .partyPort }}
{{- end }}
{{- end }}

persistence:
  enabled: {{ .persistence | default "false" }}

modules:
  rollsite: 
    include: {{ has "rollsite" .modules }}
    ip: rollsite
    type: {{ .rollsite.type | default "ClusterIP" }}
    nodePort: {{ with .rollsite }}{{ .nodePort }}{{ end }}
    {{- with .rollsite }}
    {{- with .nodeSelector }}
    nodeSelector: 
    {{- range $k, $v := . }}
      {{ $k }}: {{ $v }}
    {{- end }}
    {{- end }}
    {{- end }}
  python: 
    include: {{ has "python" .modules }}
    fateboardIp: fateboard
    fateboardType: ClusterIP
    fateflowIp: fateflow
    backend: eggroll
    spark: 
      master: spark://spark-master:7077
      home: 
      cores_per_node: 20
      nodes: 2
    hdfs:
      name_node: hdfs://namenode:9000
      path_prefix:
    rabbitmq:
      host: rabbitmq
      mng_port: 15672
      port: 5672
      user: fate
      password: fate
      # default conf/rabbitmq_route_table.yaml
      route_table: 
    nginx:
      host: nginx
      port: 9390
    {{- with .python }}
    fateflowType: {{ .fateflowType | default "ClusterIP" }}
    fateflowNodePort: {{ .fateflowNodePort }}
    {{- with .nodeSelector }}
    nodeSelector: 
    {{- range $k, $v := . }}
      {{ $k }}: {{ $v }}
    {{- end }}
    {{- end }}
    {{- end }}
  clustermanager: 
    include: {{ has "clustermanager" .modules }}
    ip: clustermanager
    type: ClusterIP
    {{- with .clustermanager }}
    {{- with .nodeSelector }}
    nodeSelector: 
    {{- range $k, $v := . }}
      {{ $k }}: {{ $v }}
    {{- end }}
    {{- end }}
    {{- end }}
  nodemanager:  
    include: {{ has "nodemanager" .modules }}
    list:
    {{- with .nodemanager }}
    {{- $nodemanager := . }}
    {{- range .count | int | until }}
    - name: nodemanager-{{ . }}
      nodeSelector: {}
      sessionProcessorsPerNode: {{ $nodemanager.sessionProcessorsPerNode }}
      subPath: "nodemanager-{{ . }}"
      existingClaim: ""
      storageClass: "{{ $nodemanager.storageClass }}"
      accessMode: {{ $nodemanager.accessMode }}
      size: {{ $nodemanager.size }}
    {{- end }}

    {{- range  $nodemanager.list }}
    - name: {{ .name }}
      {{- with .nodeSelector }}
      nodeSelector: 
      {{- range $k, $v := . }}
        {{ $k }}: {{ $v }}
      {{- end }}
      {{- end }}
      sessionProcessorsPerNode: {{ .sessionProcessorsPerNode }}
      subPath: {{ .subPath }}
      existingClaim: {{ .existingClaim }}
      storageClass: {{ .storageClass }}
      accessMode: {{ .accessMode }}
      size: {{ .size }}
    {{- end }}
    {{- end }}
  client: 
    include: {{ has "client" .modules }}
    ip: client
    type: ClusterIP
    {{- with .client }}
    {{- with .nodeSelector }}
    nodeSelector: 
    {{- range $k, $v := . }}
      {{ $k }}: {{ $v }}
    {{- end }}
    {{- end }}
    {{- end }}
  mysql: 
    {{- if .mysql }}
    include: {{ has "mysql" .modules }}
    type: ClusterIP
    {{- with .mysql }}
    {{- with .nodeSelector }}
    nodeSelector: 
    {{- range $k, $v := . }}
      {{ $k }}: {{ $v }}
    {{- end }}
    {{- end }}
    {{- end }}
    ip: {{ .mysql.ip | default "mysql" }}
    port: {{ .mysql.port | default "3306" }}
    database: {{ .mysql.database | default "eggroll_meta" }}
    user: {{ .mysql.user | default "fate" }}
    password: {{ .mysql.password | default "fate_dev" }}
    subPath: {{ .mysql.subPath }}
    existingClaim: {{ .mysql.existingClaim }}
    storageClass: {{ .mysql.storageClass }}
    accessMode: {{ .mysql.accessMode | default "ReadWriteOnce" }}
    size: {{ .mysql.size | default "1Gi" }}
    {{- else }}
    include: {{ has "mysql" .modules }}
    type: ClusterIP
    nodeSelector: {}
    ip: {{ .externalMysqlIp | default "mysql" }}
    port: {{ .externalMysqlPort | default "3306" }}
    database: {{ .externalMysqlDatabase | default "eggroll_meta" }}
    user: {{ .externalMysqlUser | default "fate" }}
    password: {{ .externalMysqlPassword | default "fate_dev" }}
    subPath: ""
    existingClaim: ""
    storageClass: "mysql"
    accessMode: ReadWriteOnce
    size: 1Gi
    {{- end }}
  serving:
    ip: {{ .servingIp }}
    port: {{ .servingPort }}
  fateboard:
    include: {{ has "fateboard" .modules }}
    type: ClusterIP
  spark:
    include: {{ has "spark" .modules }}
    master:
      Image: "{{ .spark.master.Image }}"
      ImageTag: "{{ .spark.master.ImageTag }}"
      replicas: {{ .spark.master.replicas }}
      nodeSelector: {}
      type: ClusterIP
    worker:
      Image: "{{ .spark.worker.ImageTag }}"
      ImageTag: "{{ .spark.worker.ImageTag }}"
      replicas: {{ .spark.worker.replicas }}
      nodeSelector: {}
      type: ClusterIP
  hdfs:
    include: {{ has "hdfs" .modules }}
    namenode:
      nodeSelector: {}
      type: ClusterIP
    datanode:
      nodeSelector: {}
      type: ClusterIP
  nginx:
    include: {{ has "nginx" .modules }}
    nodeSelector: {}
    type: ClusterIP
    route_table: 
      10000: 
        proxy: 
          - host: 192.168.0.1 
            port: 9390
        fateflow: 
          - host: 192.168.0.1
            port: 9360
  rabbitmq:
    include: {{ has "rabbitmq" .modules }}
    nodeSelector: {}
    type: ClusterIP
    default_user: fate
    default_pass: fate
    user: fate
    password: fate
    route_table:
      10000:
        host: rabbitmq
        port: 5672
    
